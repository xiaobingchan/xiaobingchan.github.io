<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="青年夏日IT">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="https://qnxr.xyz/img/home-bg-jeep.jpg">
    <meta property="twitter:image" content="https://qnxr.xyz/img/home-bg-jeep.jpg" />
    

    
    <meta name="title" content="Python 虚拟环境全知道" />
    <meta property="og:title" content="Python 虚拟环境全知道" />
    <meta property="twitter:title" content="Python 虚拟环境全知道" />
    

    
    <meta name="description" content="青年夏日，程序员, 开源爱好者，生活探险家 | 这里是 青年夏日 的博客，与你一起发现更大的世界。">
    <meta property="og:description" content="青年夏日，程序员, 开源爱好者，生活探险家 | 这里是 青年夏日 的博客，与你一起发现更大的世界。" />
    <meta property="twitter:description" content="青年夏日，程序员, 开源爱好者，生活探险家 | 这里是 青年夏日 的博客，与你一起发现更大的世界。" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="青年夏日, 博客, 个人网站, 互联网, Web, 云原生, PaaS, Istio, Kubernetes, 微服务, Microservice">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>Python 虚拟环境全知道-青年夏日IT</title>

    <link rel="canonical" href="/post/python-virtualenv-all-know/">

    <link rel="stylesheet" href="/css/iDisqus.min.css"/>

    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">

    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet" type="text/css">

    
    

    
    
    <script src="/js/jquery.min.js"></script>

    
    <script src="/js/bootstrap.min.js"></script>

    
    <script src="/js/hux-blog.min.js"></script>

    
    

</head>



<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">青年夏日IT</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                        
                        <li>
                            <a href="/categories/life">life</a>
                        </li>
                        
                        <li>
                            <a href="/categories/note">note</a>
                        </li>
                        
                        <li>
                            <a href="/categories/tech">tech</a>
                        </li>
                        
                        <li>
                            <a href="/categories/tips">tips</a>
                        </li>
                        
                    
                    
		    
                        <li><a href="/top/books/">BOOKS</a></li>
                    
                        <li><a href="/top/about/">ABOUT</a></li>
                    

                    
		    <li>
                        <a href="/search">SEARCH <img src="/img/search.png" height="15" style="cursor: pointer;" alt="Search"></a>
		    </li>
                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('/img/home-bg-jeep.jpg')
    }
</style>
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/python" title="python">
                            python
                        </a>
                        
                        <a class="tag" href="/tags/pyenv" title="pyenv">
                            pyenv
                        </a>
                        
                        <a class="tag" href="/tags/virtualenv" title="virtualenv">
                            virtualenv
                        </a>
                        
                        <a class="tag" href="/tags/docker" title="docker">
                            docker
                        </a>
                        
                    </div>
                    <h1>Python 虚拟环境全知道</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        Posted by 
                        
                                青年夏日IT
                         
                        on 
                        Tuesday, January 9, 2018
                        
                        
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-11 col-lg-offset-1
                col-md-10 col-md-offset-1
                post-container">

                
                <header>
                    <h2>TOC</h2>
                </header>
                <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#需求">需求</a></li>
        <li><a href="#解决方案">解决方案</a></li>
        <li><a href="#参考资料">参考资料：</a></li>
      </ul>
    </li>
  </ul>
</nav>
                
                <p>对于每个<code>python</code>项目依赖的库版本都有可能不一样，如果将依赖包都安装到公共环境的话显然是没法进行区分的，甚至是不同的项目使用的<code>python</code>版本都不尽相同，有的用<code>python2.7</code>，有的用<code>python3.6</code>，所以对于<code>python</code>项目的环境进行隔离管理就成为一个必然的需求了。</p>
<h2 id="需求">需求</h2>
<ul>
<li>不同项目间能区分依赖包版本</li>
<li>不同项目间能区分<code>python</code>版本</li>
<li>方便自由切换</li>
</ul>
<h2 id="解决方案">解决方案</h2>
<ul>
<li>解决依赖包问题：<code>virtualenv</code></li>
<li>解决<code>python</code>版本问题：<code>pyenv</code></li>
<li>终极(也许吧)解决方案：<code>docker</code></li>
</ul>
<h3 id="virtualenv">virtualenv</h3>
<p>运行<code>pip install virtualenv</code>即可安装<code>virtualenv</code>，当然了还可以用<code>easy_install</code>安装，即使是没有安装任何<code>Python</code>包管理器(比如<strong>pip</strong>)，也可以直接获取<a href="https://raw.github.com/pypa/virtualenv/master/virtualenv.py">virtualenv.py</a>并运行<code>python virtualenv.py</code>，效果也是一样的，当然我还是强烈推荐你安装包管理工具：<code>pip</code>，他一定能为你带来很多便利的(新版本的<code>virtualenv</code>也包含了<code>pip</code>管理工具)。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ pip install virtualenv
Collecting virtualenv
  Using cached virtualenv-15.1.0-py2.py3-none-any.whl
Installing collected packages: virtualenv
Successfully installed virtualenv-15.1.0
</code></pre></div><p>安装完成后，就可以直接创建一个虚拟环境了(<strong>virtualenv 环境名称</strong>):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ virtualenv env4test
</code></pre></div><p>创建完成后，用下面的命令即可激活当前虚拟环境：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ <span style="color:#8be9fd;font-style:italic">source</span> env4test/bin/activate
<span style="color:#ff79c6">(</span>env4test<span style="color:#ff79c6">)</span>$
</code></pre></div><p>现在就可以随意的安装你的依赖包了，现在安装的包只会对当前环境<code>env4test</code>有效，比如安装<code>django2.0</code>：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#ff79c6">(</span>env4test<span style="color:#ff79c6">)</span>$ pip install django
</code></pre></div><p>要退出当前虚拟环境也是非常简单的，如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ deactivate
</code></pre></div><p>现在我们用<code>pip list</code>命令可以发现已经没有<code>django</code>的身影了。</p>
<p><code>virtualenv</code>还有很多高级的用法，可以<a href="https://virtualenv-chinese-docs.readthedocs.io/en/latest/">前往该文档查看</a>。</p>
<h3 id="virtualenvwrapper">virtualenvwrapper</h3>
<p><code>virtualenvwrapper</code>是<code>virtualenv</code>的一个扩展包，可以让你更加方便的使用<code>virtualenv</code>，优点：</p>
<ul>
<li>将所有虚拟环境整合在一个目录下</li>
<li>管理（新增，删除，复制）虚拟环境</li>
<li>方便切换虚拟环境</li>
</ul>
<p>安装也很方便，用包管理工具即可：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ pip install virtualenvwrapper
</code></pre></div><p>安装完成以后还需要小小的配置一下才可以使用，首先我们找到<code>virtualenvwrapper.sh</code>的文章，通常会是：<code>/usr/local/bin/virtualenvwrapper.sh</code>：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo find / -name virtualenvwrapper.sh
Password:
/usr/local/bin/virtualenvwrapper.sh
</code></pre></div><p>然后我们可以在<code>.zshrc</code>(取决于你用的终端，我用的<code>zsh</code>)添加一行命令：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">source /usr/local/bin/virtualenvwrapper.sh
</code></pre></div><p>然后让我们的配置生效：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ <span style="color:#8be9fd;font-style:italic">source</span> ~/.zshrc
</code></pre></div><p>现在我们就可以使用<code>virtualenvwrapper</code>的基本命令了：</p>
<ul>
<li>创建基本环境：<strong>mkvirtualenv</strong> [环境名]</li>
<li>删除环境：<strong>rmvirtualenv</strong> [环境名]</li>
<li>激活环境：<strong>workon</strong> [环境名]</li>
<li>退出环境：<strong>deactivate</strong></li>
<li>列出所有环境：<strong>workon</strong>或者<strong>lsvirtualenv -b</strong></li>
</ul>
<p>参考文档：<a href="https://virtualenvwrapper.readthedocs.io/en/latest/">https://virtualenvwrapper.readthedocs.io/en/latest/</a></p>
<h3 id="pyenv">pyenv</h3>
<p><code>pyenv</code>是<code>Python</code>版本管理工具，可以改变全局的<code>Python</code>版本，安装多个版本的<code>Pytho</code>，设置目录级别的<code>Python</code>版本，还能创建和管理虚拟环境。所有的设置都是用户级别的操作，不需要<code>sudo</code>命令。
<code>pyenv</code>通过系统修改环境变量来实现<code>Python</code>不同版本的切换。而<code>virtualenv</code> 通过将<code>Python</code>包安装到一个目录来作为<code>Python</code> 包虚拟环境，通过切换目录来实现不同包环境间的切换。</p>
<p>如果你使用的<code>MAC</code>系统，推荐使用<code>homebrew</code>来安装：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ brew update
$ brew install pyenv
</code></pre></div><p>如果你使用的是其他系统，也不担心，<code>pyenv</code>官方提供了一键安装的方式：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ curl -L https://raw.githubusercontent.com/pyenv/pyenv-installer/master/bin/pyenv-installer | bash
</code></pre></div><p>安装完成以后，可以添加几条命令到<code>.zshrc</code>(同样的也可能是.bashrc，根据自己使用的终端进行配置)中开启自动补全功能：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">export PATH=$HOME/.pyenv/bin:$PATH
eval &#34;$(pyenv init -)&#34;
eval &#34;$(pyenv virtualenv-init -)&#34;
</code></pre></div><p>然后同样激活上面的配置：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ <span style="color:#8be9fd;font-style:italic">source</span> ~/.zshrc
</code></pre></div><p>现在我们就可以使用<code>pyenv</code>了：</p>
<ul>
<li>查看本机安装<code>Python</code>版本：</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ pyenv versions
∗ system <span style="color:#ff79c6">(</span><span style="color:#8be9fd;font-style:italic">set</span> by /Users/ych/.pyenv/version<span style="color:#ff79c6">)</span>
  3.6.4
  3.6.4/envs/ops3.6.4
  3.6.4/envs/talk3.6.4
  ops3.6.4
  talk3.6.4
</code></pre></div><p>星号表示当前正在使用的<code>Python</code>版本。</p>
<ul>
<li>查看所有可安装的<code>Python</code>版本：</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ pyenv install -l
</code></pre></div><ul>
<li>安装与卸载：</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ pyenv install 2.7.3   <span style="color:#6272a4"># 安装python</span>
$ pyenv uninstall 2.7.3 <span style="color:#6272a4"># 卸载python</span>
</code></pre></div><ul>
<li>版本切换：</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ pyenv global 2.7.3
$ pyenv <span style="color:#8be9fd;font-style:italic">local</span> 2.7.3
</code></pre></div><p><code>global</code>用于设置全局的<code>Python</code>版本，通过将版本号写入<code>~/.pyenv/version</code>文件的方式。<code>local</code>用于设置本地版本，通过将版本号写入当前目录下的<code>.python-version</code>文件的方式。通过这种方式设置的<code>Python</code>版本优先级比<code>global</code>高。</p>
<ul>
<li><code>python</code>优先级：<code>shell &gt; local &gt; global</code>
<code>pyenv</code>会从当前目录开始向上逐级查找<code>.python-version</code>文件，直到根目录为止。若找不到，就用<code>global</code>版本。</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ pyenv shell 2.7.3 <span style="color:#6272a4"># 设置面向 shell 的 Python 版本，通过设置当前 shell 的 PYENV_VERSION 环境变量的方式。这个版本的优先级比 local 和 global 都要高。</span>
$ pyenv shell --unset  <span style="color:#6272a4"># –unset 参数用于取消当前 shell 设定的版本。</span>
</code></pre></div><h3 id="pyenv-virtualenv">pyenv-virtualenv</h3>
<p>自动安装<code>pyenv</code>后，它会自动安装部分插件，通过<code>pyenv-virtualenv</code>插件可以很好的和<code>virtualenv</code>进行结合：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ ls -la ~/.pyenv/plugins
total <span style="color:#bd93f9">8</span>
drwxr-xr-x   <span style="color:#bd93f9">9</span> ych  staff  <span style="color:#bd93f9">288</span> <span style="color:#bd93f9">12</span> <span style="color:#bd93f9">26</span> 16:27 .
drwxr-xr-x  <span style="color:#bd93f9">23</span> ych  staff  <span style="color:#bd93f9">736</span> <span style="color:#bd93f9">12</span> <span style="color:#bd93f9">26</span> 17:44 ..
-rw-r--r--   <span style="color:#bd93f9">1</span> ych  staff   <span style="color:#bd93f9">52</span> <span style="color:#bd93f9">12</span> <span style="color:#bd93f9">26</span> 16:26 .gitignore
drwxr-xr-x  <span style="color:#bd93f9">11</span> ych  staff  <span style="color:#bd93f9">352</span> <span style="color:#bd93f9">12</span> <span style="color:#bd93f9">26</span> 16:27 pyenv-doctor
drwxr-xr-x  <span style="color:#bd93f9">12</span> ych  staff  <span style="color:#bd93f9">384</span> <span style="color:#bd93f9">12</span> <span style="color:#bd93f9">26</span> 16:27 pyenv-installer
drwxr-xr-x   <span style="color:#bd93f9">7</span> ych  staff  <span style="color:#bd93f9">224</span> <span style="color:#bd93f9">12</span> <span style="color:#bd93f9">26</span> 16:27 pyenv-update
drwxr-xr-x  <span style="color:#bd93f9">13</span> ych  staff  <span style="color:#bd93f9">416</span> <span style="color:#bd93f9">12</span> <span style="color:#bd93f9">26</span> 16:27 pyenv-virtualenv
drwxr-xr-x   <span style="color:#bd93f9">8</span> ych  staff  <span style="color:#bd93f9">256</span> <span style="color:#bd93f9">12</span> <span style="color:#bd93f9">26</span> 16:27 pyenv-which-ext
drwxr-xr-x   <span style="color:#bd93f9">8</span> ych  staff  <span style="color:#bd93f9">256</span> <span style="color:#bd93f9">12</span> <span style="color:#bd93f9">26</span> 16:26 python-build
</code></pre></div><p>基本使用命令：</p>
<ul>
<li>列出当前虚拟环境：<code>pyenv virtualenvs</code></li>
<li>激活虚拟环境：<code>pyenv activate 环境名称</code></li>
<li>退出虚拟环境：<code>pyenv deactivate</code></li>
<li>删除虚拟环境：<code>pyenv uninstall 环境名称</code>或者<code>rm -rf ~/.pyenv/versions/环境名称</code></li>
<li>创建虚拟环境：<code>pyenv virtualenv 3.6.4 env3.6.4</code></li>
</ul>
<blockquote>
<p>若不指定python 版本，会默认使用当前环境python 版本。如果指定Python 版本，则一定要是已经安装过的版本，否则会出错。环境的真实目录位于<code>~/.pyenv/versions</code>下。</p>
</blockquote>
<p>总结：利用<code>pyenv</code>和<code>pyenv-virtualenv</code>插件就能够简单方便的将<code>python</code>版本和依赖包进行环境隔离了，在实际开发过程中比较推荐这种方式。</p>
<p>参考文档：<a href="https://github.com/pyenv/pyenv">https://github.com/pyenv/pyenv</a>。</p>
<h3 id="docker">Docker</h3>
<p>有没有一种方式能够不按照这些工具来进行环境隔离的呢？当然有，那就是大名鼎鼎的<code>Docker</code>。如果你的服务都是容器化的话，应该对<code>Docker</code>不陌生，将当前项目跑在一个隔离的容器中，对系统中的其他服务或者项目是没有任何影响的，不用担心会污染环境，唯一不友好的地方是项目中的代码改变后需要重新构建镜像。</p>
<p>比如现在有一个<code>django</code>的项目，项目结构如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ testpyenv  tree
.
├── manage.py
└── testpyenv
    ├── __init__.py
    ├── settings.py
    ├── urls.py
    └── wsgi.py
</code></pre></div><p>在项目根目录下面新建文件<code>requirements.txt</code>：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">Django==2.0
</code></pre></div><p>然后我们在根目录下面创建一个<code>Dockerfile</code>文件：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#ff79c6">FROM</span><span style="color:#f1fa8c"> python:3.6.4</span>

<span style="color:#6272a4"># 设置工作目录</span>
<span style="color:#ff79c6">RUN</span> mkdir -p /usr/src/app
<span style="color:#ff79c6">WORKDIR</span><span style="color:#f1fa8c"> /usr/src/app</span>

<span style="color:#6272a4"># 添加依赖（利用Docker 的缓存）</span>
<span style="color:#ff79c6">ADD</span> ./requirements.txt /usr/src/app/requirements.txt

<span style="color:#6272a4"># 安装依赖</span>
<span style="color:#ff79c6">RUN</span> pip install -r requirements.txt

<span style="color:#6272a4"># 添加应用</span>
<span style="color:#ff79c6">ADD</span> . /usr/src/app

<span style="color:#6272a4"># 运行服务</span>
<span style="color:#ff79c6">CMD</span> python manage.py runserver 0.0.0.0:8000
</code></pre></div><p>因为<code>django2.0</code>只支持<code>python3</code>以上了，所以我们这里基础镜像使用<code>python:3.6.4</code>，然后是添加应用代码，安装依赖，运行服务等。然后我们构建一个镜像：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker build -t cnych/testpyenv:v0.1.1 .
</code></pre></div><p>构建完成以后，在我们项目根目录中新建一个<code>start.sh</code>的脚本来启动容器：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">docker run -d -p 8000:8000 --name testpyenv cnych/testpyenv:v0.1.1
</code></pre></div><p>将本地的<code>8000</code>端口和容器的<code>8000</code>进行映射，执行我们的启动脚本：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ <span style="color:#8be9fd;font-style:italic">source</span> start.sh
</code></pre></div><p>启动完成后，我们就可以在本地通过<code>http://127.0.0.1:8000</code>进行访问了。

  <img src="/img/posts/django2-index.jpg" alt="django-index">


但是如果只这样配置的话，的确能够解决我们的环境隔离问题，但是现在有一个最大的一个问题是，每次代码更改过后都需要重新构建镜像才能生效，这对于开发阶段是非常不友好的，有什么解决方案呢？你是否还记得当你更改了代码后<code>django</code>项目会自动加载的，要是每次更改了项目代码后，容器中的代码也变化的话那岂不是容器中的服务也自动加载了？是不是？</p>
<p>幸好<code>Docker</code>为我们提供了<code>volume</code>挂载的概念，我们只需要将我们的代码挂载到容器中的工作目录就行了，现在来更改<code>start.sh</code>脚本：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">work_path=$(pwd)
docker run -d -p 8000:8000 --name testpyenv -v ${work_path}:/usr/src/app cnych/testpyenv:v0.1.1
</code></pre></div><p>然后激活启动脚本，随意更改一次代码，看看是否能够及时生效，怎样查看呢？查看日志就行了：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker logs -f testpyenv
</code></pre></div><p>最后，如果是生产环境记得把代码挂载给去掉，因为线上不需要这样做，只需要构建一次就行。</p>
<h2 id="参考资料">参考资料：</h2>
<ul>
<li><a href="https://virtualenv-chinese-docs.readthedocs.io/en/latest/">https://virtualenv-chinese-docs.readthedocs.io/en/latest/</a></li>
<li><a href="https://virtualenvwrapper.readthedocs.io/en/latest/">https://virtualenvwrapper.readthedocs.io/en/latest/</a></li>
<li><a href="https://github.com/pyenv/pyenv">https://github.com/pyenv/pyenv</a></li>
<li><a href="/post/tdd-develop-python-microservice-app">TDD开发容器化的Python微服务应用(一)</a></li>
</ul>
<p>扫描下面的二维码(或微信搜索<code>iEverything</code>)添加我微信好友(注明<code>python</code>)，然后可以加入到我们的<code>python</code>讨论群里面共同学习

  <img src="/img/posts/wexin-qrcode.jpeg" alt="qrcode">

</p>

                
                
<div class="entry-shang text-center">
    
	    <p> 「如果这篇文章对你有用,请随意打赏」</p>
	
	<button class="zs show-zs btn btn-bred">赞赏支持</button>
</div>
<div class="zs-modal-bg"></div>
<div class="zs-modal-box">
	<div class="zs-modal-head">
		<button type="button" class="close">×</button>
		<span class="author"><a href="https://qnxr.xyz"><img src="/img/favicon.png" />青年夏日IT</a></span>
        
	        <p class="tip"><i></i><span>如果这篇文章对你有用,请随意打赏</span></p>
		
 
	</div>
	<div class="zs-modal-body">
		<div class="zs-modal-btns">
			<button class="btn btn-blink" data-num="2">2元</button>
			<button class="btn btn-blink" data-num="5">5元</button>
			<button class="btn btn-blink" data-num="10">10元</button>
			<button class="btn btn-blink" data-num="50">50元</button>
			<button class="btn btn-blink" data-num="100">100元</button>
			<button class="btn btn-blink" data-num="1">任意金额</button>
		</div>
		<div class="zs-modal-pay">
			<button class="btn btn-bred" id="pay-text">2元</button>
			<p>使用<span id="pay-type">微信</span>扫描二维码完成支付</p>
			<img src="/img/reward/wechat-2.png"  id="pay-image"/>
		</div>
	</div>
	<div class="zs-modal-footer">
		<label><input type="radio" name="zs-type" value="wechat" class="zs-type" checked="checked"><span ><span class="zs-wechat"><img src="/img/reward/wechat-btn.png"/></span></label>
		<label><input type="radio" name="zs-type" value="alipay" class="zs-type" class="zs-alipay"><img src="/img/reward/alipay-btn.png"/></span></label>
	</div>
</div>
<script type="text/javascript" src="/js/reward.js"></script>

                

                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2018/01/02/nginmesh-install/" data-toggle="tooltip" data-placement="top" title="Nginx开源Service Mesh组件Nginmesh安装指南">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/post/tdd-develop-python-microservice-app-part2/" data-toggle="tooltip" data-placement="top" title="TDD开发容器化的Python微服务应用(二)">Next
                            Post &rarr;</a>
                    </li>
                    
                </ul>

                
<div id="disqus-comment"></div>



            </div>
            
            <div class="
                col-lg-11 col-lg-offset-1
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">标签</a></h5>
                    <div class="tags">
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/affinity" title="affinity">
                            affinity
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/alertmanager" title="alertmanager">
                            alertmanager
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/argo" title="argo">
                            argo
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/cd" title="cd">
                            cd
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/ci" title="ci">
                            ci
                        </a>
                        
                        
                        
                        <a href="/tags/ci/cd" title="ci/cd">
                            ci/cd
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/configmap" title="configmap">
                            configmap
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/coredns" title="coredns">
                            coredns
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/dashboard" title="dashboard">
                            dashboard
                        </a>
                        
                        
                        
                        <a href="/tags/deployment" title="deployment">
                            deployment
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/devops" title="devops">
                            devops
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/django" title="django">
                            django
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/docker" title="docker">
                            docker
                        </a>
                        
                        
                        
                        <a href="/tags/dockerfile" title="dockerfile">
                            dockerfile
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/drone" title="drone">
                            drone
                        </a>
                        
                        
                        
                        <a href="/tags/efk" title="efk">
                            efk
                        </a>
                        
                        
                        
                        <a href="/tags/elastic" title="elastic">
                            elastic
                        </a>
                        
                        
                        
                        <a href="/tags/elasticsearch" title="elasticsearch">
                            elasticsearch
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/envoy" title="envoy">
                            envoy
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/flask" title="flask">
                            flask
                        </a>
                        
                        
                        
                        <a href="/tags/fluentd" title="fluentd">
                            fluentd
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/github" title="github">
                            github
                        </a>
                        
                        
                        
                        <a href="/tags/gitlab" title="gitlab">
                            gitlab
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/gitops" title="gitops">
                            gitops
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/goland" title="goland">
                            goland
                        </a>
                        
                        
                        
                        <a href="/tags/golang" title="golang">
                            golang
                        </a>
                        
                        
                        
                        <a href="/tags/grafana" title="grafana">
                            grafana
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/haproxy" title="haproxy">
                            haproxy
                        </a>
                        
                        
                        
                        <a href="/tags/harbor" title="harbor">
                            harbor
                        </a>
                        
                        
                        
                        <a href="/tags/helm" title="helm">
                            helm
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/https" title="https">
                            https
                        </a>
                        
                        
                        
                        <a href="/tags/hugo" title="hugo">
                            hugo
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/ingress" title="ingress">
                            ingress
                        </a>
                        
                        
                        
                        <a href="/tags/ingress-nginx" title="ingress-nginx">
                            ingress-nginx
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/iptables" title="iptables">
                            iptables
                        </a>
                        
                        
                        
                        <a href="/tags/ipvs" title="ipvs">
                            ipvs
                        </a>
                        
                        
                        
                        <a href="/tags/istio" title="istio">
                            istio
                        </a>
                        
                        
                        
                        <a href="/tags/java" title="java">
                            java
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/jenkins" title="jenkins">
                            jenkins
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/k8s" title="k8s">
                            k8s
                        </a>
                        
                        
                        
                        <a href="/tags/k8s%E6%8A%80%E6%9C%AF%E5%9C%88" title="k8s技术圈">
                            k8s技术圈
                        </a>
                        
                        
                        
                        <a href="/tags/kafka" title="kafka">
                            kafka
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/kibana" title="kibana">
                            kibana
                        </a>
                        
                        
                        
                        <a href="/tags/kind" title="kind">
                            kind
                        </a>
                        
                        
                        
                        <a href="/tags/kong" title="kong">
                            kong
                        </a>
                        
                        
                        
                        <a href="/tags/kubeadm" title="kubeadm">
                            kubeadm
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/kubelet" title="kubelet">
                            kubelet
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/kubernetes" title="kubernetes">
                            kubernetes
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/kustomize" title="kustomize">
                            kustomize
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/loki" title="loki">
                            loki
                        </a>
                        
                        
                        
                        <a href="/tags/mac" title="mac">
                            mac
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/microservice" title="microservice">
                            microservice
                        </a>
                        
                        
                        
                        <a href="/tags/monitor" title="monitor">
                            monitor
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/netfilter" title="netfilter">
                            netfilter
                        </a>
                        
                        
                        
                        <a href="/tags/nfs" title="nfs">
                            nfs
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/nginx" title="nginx">
                            nginx
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/operator" title="operator">
                            operator
                        </a>
                        
                        
                        
                        <a href="/tags/ops" title="ops">
                            ops
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/pipeline" title="pipeline">
                            pipeline
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/pod" title="pod">
                            pod
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/prometheus" title="prometheus">
                            prometheus
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/pv" title="pv">
                            pv
                        </a>
                        
                        
                        
                        <a href="/tags/pvc" title="pvc">
                            pvc
                        </a>
                        
                        
                        
                        <a href="/tags/pycharm" title="pycharm">
                            pycharm
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/python" title="python">
                            python
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/rbac" title="rbac">
                            rbac
                        </a>
                        
                        
                        
                        <a href="/tags/react" title="react">
                            react
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/scheduler" title="scheduler">
                            scheduler
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/security" title="security">
                            security
                        </a>
                        
                        
                        
                        <a href="/tags/service" title="service">
                            service
                        </a>
                        
                        
                        
                        <a href="/tags/service-api" title="service-api">
                            service-api
                        </a>
                        
                        
                        
                        <a href="/tags/service-mesh" title="service-mesh">
                            service-mesh
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/slave" title="slave">
                            slave
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/storageclass" title="storageclass">
                            storageclass
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/tcpdump" title="tcpdump">
                            tcpdump
                        </a>
                        
                        
                        
                        <a href="/tags/tdd" title="tdd">
                            tdd
                        </a>
                        
                        
                        
                        <a href="/tags/tekton" title="tekton">
                            tekton
                        </a>
                        
                        
                        
                        <a href="/tags/tips" title="tips">
                            tips
                        </a>
                        
                        
                        
                        <a href="/tags/traefik" title="traefik">
                            traefik
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/vault" title="vault">
                            vault
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/vscode" title="vscode">
                            vscode
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/webpack" title="webpack">
                            webpack
                        </a>
                        
                        
                        
                        <a href="/tags/websocket" title="websocket">
                            websocket
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/wsl" title="wsl">
                            wsl
                        </a>
                        
                        
                        
                        <a href="/tags/yaml" title="yaml">
                            yaml
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1" title="微服务">
                            微服务
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E7%9F%A5%E8%AF%86%E6%98%9F%E7%90%83" title="知识星球">
                            知识星球
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E8%AF%BE%E7%A8%8B" title="课程">
                            课程
                        </a>
                        
                        
                        
                        <a href="/tags/%E8%B0%83%E5%BA%A6" title="调度">
                            调度
                        </a>
                        
                        
                        
                        <a href="/tags/%E9%98%BF%E9%87%8C%E4%BA%91" title="阿里云">
                            阿里云
                        </a>
                        
                        
                        
                        
                        
                        
                    </div>
                </section>
                

                
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                    
                    <li>
                        <a href="mailto:1290851757@qq.com">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    

                    
                    <li>
                        <a href="img/wechat_qrcode.jpg">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    

                    
                    <li>
                        <a target="_blank" href="img/wechat_qrcode.jpg">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    

		    
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/xiaobingchan">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    <li>
                        <a target="_blank" href="img/alipay.jpg">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    
                    
            
            
            
                </ul>
		<p class="copyright text-muted">
                    Copyright &copy; 青年夏日IT 2021
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite"></a><a href="http://qnxr.xyz">青年夏日IT版权所有</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=xiaobingchan&repo=xiaobingchan.github.io&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-150373352-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</body>
</html>
