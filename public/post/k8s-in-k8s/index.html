<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="é’å¹´å¤æ—¥IT">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="https://qnxr.xyz/img/home-bg-jeep.jpg">
    <meta property="twitter:image" content="https://qnxr.xyz/img/home-bg-jeep.jpg" />
    

    
    <meta name="title" content="åœ¨ Kubernetes ä¸­è¿è¡Œ Kubernetes" />
    <meta property="og:title" content="åœ¨ Kubernetes ä¸­è¿è¡Œ Kubernetes" />
    <meta property="twitter:title" content="åœ¨ Kubernetes ä¸­è¿è¡Œ Kubernetes" />
    

    
    <meta name="description" content="é’å¹´å¤æ—¥ï¼Œç¨‹åºå‘˜, å¼€æºçˆ±å¥½è€…ï¼Œç”Ÿæ´»æ¢é™©å®¶ | è¿™é‡Œæ˜¯ é’å¹´å¤æ—¥ çš„åšå®¢ï¼Œä¸ä½ ä¸€èµ·å‘ç°æ›´å¤§çš„ä¸–ç•Œã€‚">
    <meta property="og:description" content="é’å¹´å¤æ—¥ï¼Œç¨‹åºå‘˜, å¼€æºçˆ±å¥½è€…ï¼Œç”Ÿæ´»æ¢é™©å®¶ | è¿™é‡Œæ˜¯ é’å¹´å¤æ—¥ çš„åšå®¢ï¼Œä¸ä½ ä¸€èµ·å‘ç°æ›´å¤§çš„ä¸–ç•Œã€‚" />
    <meta property="twitter:description" content="é’å¹´å¤æ—¥ï¼Œç¨‹åºå‘˜, å¼€æºçˆ±å¥½è€…ï¼Œç”Ÿæ´»æ¢é™©å®¶ | è¿™é‡Œæ˜¯ é’å¹´å¤æ—¥ çš„åšå®¢ï¼Œä¸ä½ ä¸€èµ·å‘ç°æ›´å¤§çš„ä¸–ç•Œã€‚" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="é’å¹´å¤æ—¥, åšå®¢, ä¸ªäººç½‘ç«™, äº’è”ç½‘, Web, äº‘åŸç”Ÿ, PaaS, Istio, Kubernetes, å¾®æœåŠ¡, Microservice">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>åœ¨ Kubernetes ä¸­è¿è¡Œ Kubernetes-é’å¹´å¤æ—¥IT</title>

    <link rel="canonical" href="/post/k8s-in-k8s/">

    <link rel="stylesheet" href="/css/iDisqus.min.css"/>

    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">

    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet" type="text/css">

    
    

    
    
    <script src="/js/jquery.min.js"></script>

    
    <script src="/js/bootstrap.min.js"></script>

    
    <script src="/js/hux-blog.min.js"></script>

    
    

</head>



<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">é’å¹´å¤æ—¥IT</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                        
                        <li>
                            <a href="/categories/life">life</a>
                        </li>
                        
                        <li>
                            <a href="/categories/note">note</a>
                        </li>
                        
                        <li>
                            <a href="/categories/tech">tech</a>
                        </li>
                        
                        <li>
                            <a href="/categories/tips">tips</a>
                        </li>
                        
                    
                    
		    
                        <li><a href="/top/books/">BOOKS</a></li>
                    
                        <li><a href="/top/about/">ABOUT</a></li>
                    

                    
		    <li>
                        <a href="/search">SEARCH <img src="/img/search.png" height="15" style="cursor: pointer;" alt="Search"></a>
		    </li>
                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('/img/home-bg-jeep.jpg')
    }
</style>
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/kubernetes" title="kubernetes">
                            kubernetes
                        </a>
                        
                        <a class="tag" href="/tags/wsl" title="wsl">
                            wsl
                        </a>
                        
                        <a class="tag" href="/tags/kind" title="kind">
                            kind
                        </a>
                        
                        <a class="tag" href="/tags/docker" title="docker">
                            docker
                        </a>
                        
                    </div>
                    <h1>åœ¨ Kubernetes ä¸­è¿è¡Œ Kubernetes</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        Posted by 
                        
                                é’å¹´å¤æ—¥IT
                         
                        on 
                        Friday, June 12, 2020
                        
                        
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-11 col-lg-offset-1
                col-md-10 col-md-offset-1
                post-container">

                
                <header>
                    <h2>TOC</h2>
                </header>
                <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#åœ¨-pod-ä¸­å®‰è£…-docker-daemon">åœ¨ Pod ä¸­å®‰è£… Docker Daemon</a></li>
        <li><a href="#åœ¨-pod-ä¸­è¿è¡Œ-kind">åœ¨ Pod ä¸­è¿è¡Œ KinD</a></li>
        <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
      </ul>
    </li>
  </ul>
</nav>
                
                <p><a href="/post/deploy-k8s-on-win-use-wsl2/">å‰é¢å…¶å®æˆ‘ä»¬åœ¨ Windows ç³»ç»Ÿçš„ WSL2 ä¸‹é¢ä½¿ç”¨ KinD æ­å»ºäº†ä¸€å¥— Kubernetes é›†ç¾¤</a>ï¼ŒKinD æ˜¯ä¸€ä¸ªéå¸¸è½»é‡çº§çš„ Kubernetes å®‰è£…å·¥å…·ï¼Œä»–å°† Docker å®¹å™¨å½“æˆ Kubernetes çš„èŠ‚ç‚¹ï¼Œä½¿ç”¨éå¸¸æ–¹ä¾¿ã€‚æ—¢ç„¶åœ¨ Docker å®¹å™¨ä¸­å¯ä»¥è¿è¡Œ Kubernetes é›†ç¾¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬è‡ªç„¶å°±ä¼šæƒ³åˆ°æ˜¯å¦å¯ä»¥åœ¨ Pod ä¸­æ¥è¿è¡Œå‘¢ï¼Ÿåœ¨ Pod ä¸­è¿è¡Œä¼šé‡åˆ°å“ªäº›é—®é¢˜å‘¢ï¼Ÿ</p>
<h2 id="åœ¨-pod-ä¸­å®‰è£…-docker-daemon">åœ¨ Pod ä¸­å®‰è£… Docker Daemon</h2>
<p>KinD ç°åœ¨æ˜¯ä¾èµ–ä¸ Docker çš„ï¼Œæ‰€ä»¥é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå…è®¸æˆ‘ä»¬åœ¨ Pod ä¸­è¿è¡Œ Docker Deamon çš„é•œåƒï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ Pod é‡Œé¢å»æ‰§è¡Œ <code>docker run</code> è¿™æ ·çš„å‘½ä»¤ï¼Œå½“ç„¶è¿™ä¸ªå’Œæˆ‘ä»¬ä¹‹å‰è¯´çš„æŒ‚è½½å®¿ä¸»æœºçš„ docker.sock è¿™ç§ DIND æ¨¡å¼æ˜¯ä¸ä¸€æ ·çš„ã€‚è¦æƒ³åœ¨ Pod ä¸­è¿è¡Œ Docker Deamon ä¾ç„¶ä¼šæœ‰ä¸å°‘é—®é¢˜çš„ã€‚</p>
<h3 id="pid-1-çš„é—®é¢˜">PID 1 çš„é—®é¢˜</h3>
<p>æ¯”å¦‚æˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸ªå®¹å™¨ä¸­å»è¿è¡Œ Docker Daemon ä»¥åŠä¸€äº› Kubernetes çš„é›†ç¾¤æµ‹è¯•ï¼Œè€Œè¿™äº›æµ‹è¯•ä¾èµ–äº KinD å’Œ Docker Damonï¼Œåœ¨ä¸€ä¸ªå®¹å™¨ä¸­è¿è¡Œå¤šä¸ªæœåŠ¡æˆ‘ä»¬å¯èƒ½ä¼šå»ä½¿ç”¨ systemdï¼Œä½†æ˜¯ä½¿ç”¨ systemd ä¹Ÿä¼šæœ‰ä¸€äº›é—®é¢˜ã€‚</p>
<ol>
<li>æ¯”å¦‚æˆ‘ä»¬éœ€è¦ä¿ç•™æµ‹è¯•çš„é€€å‡ºçŠ¶æ€ï¼ŒKubernetes ä¸­ä½¿ç”¨çš„å®¹å™¨è¿è¡Œæ—¶å¯ä»¥ watch åˆ°å®¹å™¨ä¸­çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼ˆPID 1ï¼‰çš„é€€å‡ºçŠ¶æ€ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ systemd çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬æµ‹è¯•çš„è¿›ç¨‹é€€å‡ºçŠ¶æ€ä¸ä¼šè¢«è½¬å‘åˆ° Kubernetesã€‚</li>
<li>æ­¤å¤–è·å–æµ‹è¯•çš„æ—¥å¿—ä¹Ÿæ˜¯éå¸¸é‡è¦çš„ï¼Œåœ¨ Kubernetes ä¸­ä¼šè‡ªåŠ¨è·å–å†™å…¥åˆ° stdout å’Œ stderr çš„å®¹å™¨æ—¥å¿—ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨ systemd çš„è¯ï¼Œè¦æƒ³è·å–åº”ç”¨çš„æ—¥å¿—å°±æ¯”è¾ƒéº»çƒ¦çš„ã€‚</li>
</ol>
<p>ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®¹å™¨é•œåƒä¸­ä½¿ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„å¯åŠ¨è„šæœ¬ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">dockerd &amp;
<span style="color:#6272a4"># Wait until dockerd is ready.</span>
<span style="color:#ff79c6">until</span> docker ps &gt;/dev/null 2&gt;&amp;<span style="color:#bd93f9">1</span>
<span style="color:#ff79c6">do</span>
  <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Waiting for dockerd...&#34;</span>
  sleep <span style="color:#bd93f9">1</span>
<span style="color:#ff79c6">done</span>
<span style="color:#8be9fd;font-style:italic">exec</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$@</span><span style="color:#f1fa8c">&#34;</span>
</code></pre></div><p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬ä¸èƒ½å°†ä¸Šé¢çš„è„šæœ¬ä½œä¸ºå®¹å™¨çš„ entrypointï¼Œåœ¨é•œåƒä¸­å®šä¹‰çš„ entrypoint ä¼šåœ¨å®¹å™¨ä¸­ä»¥ PID 1 çš„å½¢å¼è¿è¡Œåœ¨ä¸€ä¸ªå•ç‹¬çš„ pid namespace ä¸­ã€‚PID 1 æ˜¯ä¸€ä¸ªå†…æ ¸ä¸­çš„ä¸€ä¸ªç‰¹æ®Šè¿›ç¨‹ï¼Œå®ƒçš„è¡Œä¸ºå’Œå…¶ä»–è¿›ç¨‹ä¸åŒã€‚</p>
<p>æœ¬è´¨ä¸Šï¼Œæ¥æ”¶ä¿¡å·çš„è¿›ç¨‹æ˜¯ PID 1ï¼šå®ƒä¼šè¢«å†…æ ¸åšç‰¹æ®Šå¤„ç†ï¼›å¦‚æœå®ƒæ²¡æœ‰ä¸ºä¿¡å·æ³¨å†Œä¸€ä¸ªå¤„ç†å™¨ï¼Œå†…æ ¸å°±ä¸ä¼šå›åˆ°é»˜è®¤è¡Œä¸ºï¼ˆå³æ€æ­»è¿›ç¨‹ï¼‰ã€‚ç”±äºå½“æ”¶åˆ° <code>SIGTERM</code> ä¿¡å·æ—¶ï¼Œå†…æ ¸ä¼šé»˜è®¤æ€æ­»è¿™ä¸ªè¿›ç¨‹ï¼Œæ‰€ä»¥ä¸€äº›è¿›ç¨‹ä¹Ÿè®¸ä¸ä¼šä¸º <code>SIGTERM</code> ä¿¡å·æ³¨å†Œä¿¡å·å¤„ç†ç¨‹åºã€‚å¦‚æœå‡ºç°äº†è¿™ç§æƒ…å†µï¼Œå½“ Kubernetes å°è¯•ç»ˆæ­¢ Pod æ—¶ï¼ŒSIGTERM å°†è¢«åå™¬ï¼Œä½ ä¼šæ³¨æ„åˆ° Pod ä¼šè¢«å¡åœ¨ <code>Terminating</code> çš„çŠ¶æ€ä¸‹ã€‚</p>
<p>è¿™å…¶å®ä¸æ˜¯ä¸€ä¸ªä»€ä¹ˆæ–°é²œçš„é—®é¢˜ï¼Œä½†æ˜¯äº†è§£è¿™ä¸ªé—®é¢˜çš„äººå´å¹¶ä¸å¤šï¼Œè€Œä¸”è¿˜ä¸€ç›´åœ¨æ„å»ºæœ‰è¿™æ ·é—®é¢˜çš„å®¹å™¨ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a href="https://github.com/krallin/tini">tini</a> è¿™ä¸ªåº”ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°†å…¶ä½œä¸ºé•œåƒçš„å…¥å£ç‚¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ENTRYPOINT <span style="color:#ff79c6">[</span><span style="color:#f1fa8c">&#34;/usr/bin/tini&#34;</span>, <span style="color:#f1fa8c">&#34;--&#34;</span>, <span style="color:#f1fa8c">&#34;/entrypoint.sh&#34;</span><span style="color:#ff79c6">]</span>
</code></pre></div><p>è¿™ä¸ªç¨‹åºä¼šæ­£ç¡®æ³¨å†Œä¿¡å·å¤„ç†ç¨‹åºå’Œè½¬å‘ä¿¡å·ã€‚å®ƒè¿˜ä¼šæ‰§è¡Œä¸€äº›å…¶ä»– PID 1 çš„äº‹æƒ…ï¼Œæ¯”å¦‚å›æ”¶å®¹å™¨ä¸­çš„åƒµå°¸è¿›ç¨‹ã€‚</p>
<h3 id="æŒ‚è½½-cgroups">æŒ‚è½½ cgroups</h3>
<p>ç”±äº Docker Daemon éœ€è¦æ§åˆ¶ cgroupsï¼Œæ‰€ä»¥éœ€è¦å°† cgroup æ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ°å®¹å™¨ä¸­å»ã€‚ä½†æ˜¯ç”±äº cgroups å’Œå®¿ä¸»æœºæ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç¡®ä¿ Docker Daemon æ§åˆ¶çš„ cgroups ä¸ä¼šå½±å“åˆ°å…¶ä»–å®¹å™¨æˆ–è€…å®¿ä¸»æœºè¿›ç¨‹ä½¿ç”¨çš„å…¶ä»– cgroupsï¼Œè¿˜éœ€è¦ç¡®ä¿ Docker Daemon åœ¨å®¹å™¨ä¸­åˆ›å»ºçš„ cgroups åœ¨å®¹å™¨é€€å‡ºåä¸ä¼šè¢«æ³„éœ²ã€‚</p>
<p>Docker Daemon ä¸­æœ‰ä¸€ä¸ª<code>--cgroupâ€”parent</code> å‚æ•°æ¥å‘Šè¯‰ Daemon å°†æ‰€æœ‰å®¹å™¨çš„ cgroups åµŒå¥—åœ¨æŒ‡å®šçš„ cgroup ä¸‹é¢ã€‚å½“å®¹å™¨è¿è¡Œåœ¨ Kubernetes é›†ç¾¤ä¸‹é¢æ—¶ï¼Œæˆ‘ä»¬åœ¨å®¹å™¨ä¸­è®¾ç½® Docker Daemon çš„<code>--cgroupâ€”parent</code> å‚æ•°ï¼Œè¿™æ ·å®ƒçš„æ‰€æœ‰ cgroups å°±ä¼šè¢«åµŒå¥—åœ¨ Kubernetes ä¸ºå®¹å™¨åˆ›å»ºçš„ cgroup ä¸‹é¢äº†ã€‚</p>
<p>åœ¨ä»¥å‰ä¸ºäº†è®© cgroup æ–‡ä»¶ç³»ç»Ÿåœ¨å®¹å™¨ä¸­å¯ç”¨ï¼Œä¸€äº›ç”¨æˆ·ä¼šå°†å®¿ä¸»æœºä¸­çš„ <code>/sys/fs/cgroup</code> æŒ‚è½½åˆ°å®¹å™¨ä¸­çš„è¿™ä¸ªä½ç½®ï¼Œå¦‚æœè¿™æ ·ä½¿ç”¨çš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨å®¹å™¨å¯åŠ¨è„šæœ¬ä¸­æŠŠ<code>--cgroupâ€”parent</code> è®¾ç½®ä¸ºä¸‹é¢çš„å†…å®¹ï¼Œè¿™æ · Docker Daemon åˆ›å»ºçš„ cgroups å°±å¯ä»¥æ­£ç¡®è¢«åµŒå¥—äº†ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8be9fd;font-style:italic">CGROUP_PARENT</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">$(</span>grep systemd /proc/self/cgroup | cut -d: -f3<span style="color:#ff79c6">)</span><span style="color:#f1fa8c">/docker&#34;</span>
</code></pre></div><blockquote>
<p>æ³¨æ„ï¼š<code>/proc/self/cgroup</code> æ˜¾ç¤ºçš„æ˜¯è°ƒç”¨è¿›ç¨‹çš„ cgorup è·¯å¾„ã€‚</p>
</blockquote>
<p>ä½†æ˜¯æˆ‘ä»¬è¦çŸ¥é“ï¼ŒæŒ‚è½½å®¿ä¸»æœºçš„ <code>/sys/fs/cgroup</code> æ–‡ä»¶æ˜¯éå¸¸å±é™©çš„äº‹æƒ…ï¼Œå› ä¸ºä»–æŠŠæ•´ä¸ªå®¿ä¸»æœºçš„ cgroup å±‚æ¬¡ç»“æ„éƒ½æš´éœ²ç»™äº†å®¹å™¨ã€‚ä»¥å‰ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒDocker ç”¨äº†ä¸€ä¸ªå°æŠ€å·§æŠŠä¸ç›¸å…³çš„ cgroups éšè—èµ·æ¥ï¼Œä¸è®©å®¹å™¨çœ‹åˆ°ã€‚Docker ä»å®¹å™¨çš„ cgroups å¯¹æ¯ä¸ª cgroup ç³»ç»Ÿçš„ cgroup å±‚æ¬¡ç»“æ„çš„æ ¹éƒ¨è¿›è¡Œç»‘å®šæŒ‚è½½ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ docker run --rm debian findmnt -lo source,target -t cgroup       
SOURCE                                                                               TARGET
cpuset<span style="color:#ff79c6">[</span>/docker/451b803b3cd7cd2b69dde64cd833fdd799ae16f9d2d942386ec382f6d55bffac<span style="color:#ff79c6">]</span>     /sys/fs/cgroup/cpuset
cpu<span style="color:#ff79c6">[</span>/docker/451b803b3cd7cd2b69dde64cd833fdd799ae16f9d2d942386ec382f6d55bffac<span style="color:#ff79c6">]</span>        /sys/fs/cgroup/cpu
cpuacct<span style="color:#ff79c6">[</span>/docker/451b803b3cd7cd2b69dde64cd833fdd799ae16f9d2d942386ec382f6d55bffac<span style="color:#ff79c6">]</span>    /sys/fs/cgroup/cpuacct
blkio<span style="color:#ff79c6">[</span>/docker/451b803b3cd7cd2b69dde64cd833fdd799ae16f9d2d942386ec382f6d55bffac<span style="color:#ff79c6">]</span>     /sys/fs/cgroup/blkio
memory<span style="color:#ff79c6">[</span>/docker/451b803b3cd7cd2b69dde64cd833fdd799ae16f9d2d942386ec382f6d55bffac<span style="color:#ff79c6">]</span>     /sys/fs/cgroup/memory
 
cgroup<span style="color:#ff79c6">[</span>/docker/451b803b3cd7cd2b69dde64cd833fdd799ae16f9d2d942386ec382f6d55bffac<span style="color:#ff79c6">]</span>     /sys/fs/cgroup/systemd
</code></pre></div><p>ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹å‡º cgroups é€šè¿‡å°†å®¿ä¸»æœº cgroup æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ <code>/sys/fs/cgroup/memory/memory.limit_in_bytes</code> æ–‡ä»¶æ˜ å°„åˆ° <code>/sys/fs/cgroup/memory/docker/&lt;CONTAINER_ID&gt;/memory.limit_in_bytes</code> æ¥æ§åˆ¶å®¹å™¨å†… cgroup å±‚æ¬¡ç»“æ„æ ¹éƒ¨çš„æ–‡ä»¶ï¼Œè¿™ç§æ–¹å¼å¯ä»¥é˜²æ­¢å®¹å™¨è¿›ç¨‹æ„å¤–åœ°ä¿®æ”¹å®¿ä¸»æœºçš„ cgroupã€‚</p>
<p>ä½†æ˜¯è¿™ç§æ–¹å¼æœ‰æ—¶å€™ä¼šè®© cadvisor å’Œ kubelet è¿™æ ·çš„åº”ç”¨æ„ŸåŠ¨å›°æƒ‘ï¼Œå› ä¸ºç»‘å®šæŒ‚è½½å¹¶ä¸ä¼šæ”¹å˜ <code>/proc/&lt;PID&gt;/cgroup</code> é‡Œé¢çš„å†…å®¹ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ docker run --rm debian cat /proc/1/cgroup                                
14:name<span style="color:#ff79c6">=</span>systemd:/docker/512f6b62e3963f85f5abc09b69c370d27ab1dc56549fa8afcbb86eec8663a141
 
5:memory:/docker/512f6b62e3963f85f5abc09b69c370d27ab1dc56549fa8afcbb86eec8663a141
4:blkio:/docker/512f6b62e3963f85f5abc09b69c370d27ab1dc56549fa8afcbb86eec8663a141
3:cpuacct:/docker/512f6b62e3963f85f5abc09b69c370d27ab1dc56549fa8afcbb86eec8663a141
2:cpu:/docker/512f6b62e3963f85f5abc09b69c370d27ab1dc56549fa8afcbb86eec8663a141
1:cpuset:/docker/512f6b62e3963f85f5abc09b69c370d27ab1dc56549fa8afcbb86eec8663a141
0::/
</code></pre></div><p>cadvisor ä¼šé€šè¿‡æŸ¥çœ‹ <code>/proc/&lt;PID&gt;/cgroup</code> æ¥è·å–ç»™å®šè¿›ç¨‹çš„ cgroupï¼Œå¹¶å°è¯•ä»å¯¹åº”çš„ cgroup ä¸­è·å– CPU æˆ–å†…å­˜ç»Ÿè®¡æ•°æ®ã€‚ä½†æ˜¯ç”±äº Docker Daemon è¿›ç¨‹åšäº†ç»‘å®šæŒ‚è½½ï¼Œcadvisor å°±æ— æ³•æ‰¾æ‰“å®¹å™¨è¿›ç¨‹å¯¹åº”çš„ cgroupã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åœ¨å®¹å™¨å†…éƒ¨åˆåšäº†ä¸€æ¬¡æŒ‚è½½ï¼Œä» <code>/sys/fs/cgroup/memory</code> æŒ‚è½½åˆ° <code>/sys/fs/cgroup/memory/docker/&lt;CONTAINER_ID&gt;/</code>ï¼ˆé’ˆå¯¹æ‰€æœ‰çš„ cgroup å­ç³»ç»Ÿï¼‰ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>ç°åœ¨æ–°çš„è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨ <a href="http://man7.org/linux/man-pages/man7/cgroup_namespaces.7.html">cgroup namespace</a>ï¼Œå¦‚æœä½ è¿è¡Œåœ¨ä¸€ä¸ªå†…æ ¸ç‰ˆæœ¬ 4.6+ çš„ Linux ç³»ç»Ÿä¸‹é¢ï¼Œrunc å’Œ docker éƒ½åŠ å…¥äº† cgroup å‘½åç©ºé—´çš„æ”¯æŒã€‚ä½†æ˜¯ç›®å‰ Kubernetes æš‚æ—¶è¿˜ä¸æ”¯æŒ cgroup å‘½åç©ºé—´ï¼Œä½†æ˜¯å¾ˆå¿«ä¼šä½œä¸º <a href="https://github.com/kubernetes/enhancements/blob/master/keps/sig-node/20191118-cgroups-v2.md">cgroups v2 æ”¯æŒ</a>çš„ä¸€éƒ¨åˆ†ã€‚</p>
<h3 id="iptables">IPtables</h3>
<p>åœ¨ä½¿ç”¨çš„æ—¶å€™æˆ‘ä»¬å‘ç°åœ¨çº¿ä¸Šçš„ Kubernetes é›†ç¾¤è¿è¡Œæ—¶ï¼Œæœ‰æ—¶å€™å®¹å™¨å†…çš„ Docker Daemon å¯åŠ¨çš„åµŒå¥—å®¹å™¨æ— æ³•è®¿é—®å¤–ç½‘ï¼Œä½†æ˜¯åœ¨æœ¬åœ°å¼€å‘ç”µè„‘ä¸Šå´å¯ä»¥å¾ˆæ­£å¸¸çš„å·¥ä½œï¼Œå¤§éƒ¨åˆ†å¼€å‘è€…åº”è¯¥éƒ½ä¼šç»å¸¸é‡åˆ°è¿™ç§æƒ…å†µã€‚</p>
<p>æœ€åå‘ç°å½“å‡ºç°è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œæ¥è‡ªåµŒå¥—çš„ Docker å®¹å™¨çš„æ•°æ®åŒ…å¹¶æ²¡æœ‰æ‰“åˆ° iptables çš„ POSTROUTING é“¾ï¼Œæ‰€ä»¥æ²¡æœ‰åš masqueradedã€‚</p>
<!-- raw HTML omitted -->
<p>è¿™ä¸ªé—®é¢˜æ˜¯å› ä¸ºåŒ…å« Docker Daemon çš„é•œåƒæ˜¯åŸºäº <a href="https://www.debian.org/releases/buster/">Debian buster</a> çš„ï¼Œè€Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒDebian buster ä½¿ç”¨çš„æ˜¯ <a href="https://wiki.debian.org/nftables">nftables</a> ä½œä¸º iptables çš„é»˜è®¤åç«¯ï¼Œç„¶è€Œ Docker æœ¬èº«è¿˜ä¸æ”¯æŒ nftablesã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜åªéœ€è¦åœ¨å®¹å™¨é•œåƒä¸­åˆ‡æ¢åˆ° iptables å‘½ä»¤å³å¯ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">RUN update-alternatives --set iptables  /usr/sbin/iptables-legacy <span style="color:#ff79c6">||</span> <span style="color:#8be9fd;font-style:italic">true</span> <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>    update-alternatives --set ip6tables /usr/sbin/ip6tables-legacy <span style="color:#ff79c6">||</span> <span style="color:#8be9fd;font-style:italic">true</span> <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>    update-alternatives --set arptables /usr/sbin/arptables-legacy <span style="color:#ff79c6">||</span> <span style="color:#8be9fd;font-style:italic">true</span>
</code></pre></div><p>å®Œæ•´çš„ Dockerfile æ–‡ä»¶å’Œå¯åŠ¨è„šæœ¬å¯ä»¥åœ¨ GitHubï¼ˆ<a href="https://github.com/jieyu/docker-images/tree/master/dind">https://github.com/jieyu/docker-images/tree/master/dind</a>ï¼‰ä¸Šé¢è·å–ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>jieyu/dind-buster:v0.1.8</code> è¿™ä¸ªé•œåƒæ¥æµ‹è¯•ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ docker run --rm --privileged jieyu/dind-buster:v0.1.8 docker run alpine wget baidu.com
</code></pre></div><p>åœ¨ Kubernetes é›†ç¾¤ä¸‹ä½¿ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„ Pod èµ„æºæ¸…å•éƒ¨ç½²å³å¯ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#ff79c6">apiVersion</span>: v1
<span style="color:#ff79c6">kind</span>: Pod
<span style="color:#ff79c6">metadata</span>:
  <span style="color:#ff79c6">name</span>: dind
<span style="color:#ff79c6">spec</span>:
  <span style="color:#ff79c6">containers</span>:
  - <span style="color:#ff79c6">image</span>: jieyu/dind-buster:v0.1.8
    <span style="color:#ff79c6">name</span>: dind
    <span style="color:#ff79c6">stdin</span>: <span style="color:#ff79c6">true</span>
    <span style="color:#ff79c6">tty</span>: <span style="color:#ff79c6">true</span>
    <span style="color:#ff79c6">args</span>:
    - /bin/bash
    <span style="color:#ff79c6">volumeMounts</span>:
    - <span style="color:#ff79c6">mountPath</span>: /var/lib/docker
      <span style="color:#ff79c6">name</span>: varlibdocker
    <span style="color:#ff79c6">securityContext</span>:
      <span style="color:#ff79c6">privileged</span>: <span style="color:#ff79c6">true</span>
  <span style="color:#ff79c6">volumes</span>:
  - <span style="color:#ff79c6">name</span>: varlibdocker
    <span style="color:#ff79c6">emptyDir</span>: {}
</code></pre></div><h2 id="åœ¨-pod-ä¸­è¿è¡Œ-kind">åœ¨ Pod ä¸­è¿è¡Œ KinD</h2>
<p>ä¸Šé¢æˆ‘ä»¬æˆåŠŸé…ç½®äº† Docker-in-Docker(DinD)ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥åœ¨è¯¥å®¹å™¨ä¸­ä½¿ç”¨ KinD å¯åŠ¨ Kubernetes é›†ç¾¤ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ docker run -ti --rm --privileged jieyu/dind-buster:v0.1.8 /bin/bash
Waiting <span style="color:#ff79c6">for</span> dockerd...
<span style="color:#ff79c6">[</span>root@257b543a91a5 /<span style="color:#ff79c6">]</span><span style="color:#6272a4"># curl -Lso ./kind https://kind.sigs.k8s.io/dl/v0.8.1/kind-$(uname)-amd64</span>
<span style="color:#ff79c6">[</span>root@257b543a91a5 /<span style="color:#ff79c6">]</span><span style="color:#6272a4"># chmod +x ./kind</span>
<span style="color:#ff79c6">[</span>root@257b543a91a5 /<span style="color:#ff79c6">]</span><span style="color:#6272a4"># mv ./kind /usr/bin/ </span>
<span style="color:#ff79c6">[</span>root@257b543a91a5 /<span style="color:#ff79c6">]</span><span style="color:#6272a4"># kind create cluster</span>
Creating cluster <span style="color:#f1fa8c">&#34;kind&#34;</span> ...
 âœ“ Ensuring node image <span style="color:#ff79c6">(</span>kindest/node:v1.18.2<span style="color:#ff79c6">)</span> ğŸ–¼ 
 âœ“ Preparing nodes ğŸ“¦  
 âœ“ Writing configuration ğŸ“œ 
 âœ“ Starting control-plane ğŸ•¹ï¸ 
 âœ“ Installing CNI ğŸ”Œ 
 âœ“ Installing StorageClass ğŸ’¾ 
Set kubectl context to <span style="color:#f1fa8c">&#34;kind-kind&#34;</span>
You can now use your cluster with:
kubectl cluster-info --context kind-kind
Have a nice day! ğŸ‘‹
<span style="color:#ff79c6">[</span>root@257b543a91a5 /<span style="color:#ff79c6">]</span><span style="color:#6272a4"># kubectl get nodes</span>
NAME                 STATUS   ROLES    AGE   VERSION
kind-control-plane   Ready    master   11m   v1.18.2
</code></pre></div><p>ç”±äºæŸäº›åŸå› å¯èƒ½ä½ ç”¨ä¸Šé¢çš„å‘½ä»¤ä¸‹è½½ä¸äº† kindï¼Œæˆ‘ä»¬å¯ä»¥æƒ³åŠæ³•æå‰ä¸‹è½½åˆ°å®¿ä¸»æœºä¸Šé¢ï¼Œç„¶åç›´æ¥æŒ‚è½½åˆ°å®¹å™¨ä¸­å»ä¹Ÿå¯ä»¥ï¼Œæˆ‘è¿™é‡Œå°† kind å’Œ kubectl å‘½ä»¤éƒ½æŒ‚è½½åˆ°å®¹å™¨ä¸­å»ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¯åŠ¨å®¹å™¨å³å¯ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ docker run -it --rm --privileged -v /usr/local/bin/kind:/usr/bin/kind -v /usr/local/bin/kubectl:/usr/bin/kubectl jieyu/dind-buster:v0.1.8 /bin/bash
</code></pre></div><p>
  <img src="https://bxdc-static.oss-cn-beijing.aliyuncs.com/images/20200612100342.png" alt="kind in docker">

</p>
<p>å¯ä»¥çœ‹åˆ°åœ¨å®¹å™¨ä¸­å¯ä»¥å¾ˆå¥½çš„ä½¿ç”¨ KinD æ¥åˆ›å»º Kubernetes é›†ç¾¤ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ç›´æ¥åœ¨ Kubernetes ä¸­æ¥æµ‹è¯•ä¸€æ¬¡ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl apply -f dind.yaml
$ kubectl <span style="color:#8be9fd;font-style:italic">exec</span> -ti dind /bin/bash
root@dind:/# curl -Lso ./kind https://kind.sigs.k8s.io/dl/v0.7.0/kind-<span style="color:#ff79c6">$(</span>uname<span style="color:#ff79c6">)</span>-amd64
root@dind:/# chmod +x ./kind
root@dind:/# mv ./kind /usr/bin/
root@dind:/# kind create cluster
Creating cluster <span style="color:#f1fa8c">&#34;kind&#34;</span> ...
 âœ“ Ensuring node image <span style="color:#ff79c6">(</span>kindest/node:v1.17.0<span style="color:#ff79c6">)</span> ğŸ–¼ 
 âœ“ Preparing nodes ğŸ“¦  
 âœ“ Writing configuration ğŸ“œ 
 âœ— Starting control-plane ğŸ•¹ï¸ 
ERROR: failed to create cluster: failed to init node with kubeadm: <span style="color:#8be9fd;font-style:italic">command</span> <span style="color:#f1fa8c">&#34;docker exec --privileged kind-control-plane kubeadm init --ignore-preflight-errors=all --config=/kind/kubeadm.conf --skip-token-print --v=6&#34;</span> failed with error: <span style="color:#8be9fd;font-style:italic">exit</span> status <span style="color:#bd93f9">137</span>
</code></pre></div><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨ Pod ä¸­ä½¿ç”¨ KinD æ¥åˆ›å»ºé›†ç¾¤å¤±è´¥äº†ï¼Œè¿™æ˜¯å› ä¸ºåœ¨ KinD èŠ‚ç‚¹åµŒå¥—å®¹å™¨å†…è¿è¡Œçš„ kubelet ä¼šéšæœºæ€æ­»é¡¶å±‚å®¹å™¨å†…çš„è¿›ç¨‹ï¼Œè¿™å…¶å®è¿˜æ˜¯å’Œä¸Šé¢è®¨è®ºçš„ cgroups çš„æŒ‚è½½æœ‰å…³ã€‚</p>
<p>ä½†å…¶å®æˆ‘è‡ªå·±åœ¨ä½¿ç”¨ v0.8.1 ç‰ˆæœ¬çš„ KinD çš„æ—¶å€™ï¼Œåœ¨ä¸Šé¢çš„ Pod ä¸­æ˜¯å¯ä»¥æ­£å¸¸åˆ›å»ºé›†ç¾¤çš„ï¼Œä¸çŸ¥é“æ˜¯å¦æ˜¯ KinD æ­å»ºçš„é›†ç¾¤æœ‰ä»€ä¹ˆç‰¹æ®Šå¤„ç†ï¼Œè¿™é‡Œéœ€è¦å†æ·±å…¥ç ”ç©¶ï¼š</p>
<p>
  <img src="https://bxdc-static.oss-cn-beijing.aliyuncs.com/images/20200612114709.png" alt="kind in pod">

</p>
<p>å¦‚æœä½ åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ä¹Ÿé‡åˆ°äº†ä¸Šè¿°çš„é—®é¢˜ï¼Œåˆ™å¯ä»¥ç»§ç»­å¾€ä¸‹çœ‹è§£å†³æ–¹æ¡ˆã€‚</p>
<p>å½“é¡¶å±‚å®¹å™¨ï¼ˆDINDï¼‰åœ¨ Kubernetes  Pod ä¸­è¿è¡Œçš„æ—¶å€™ï¼Œå¯¹äºæ¯ä¸ª cgroup å­ç³»ç»Ÿï¼ˆæ¯”å¦‚å†…å­˜ï¼‰ï¼Œä»å®¿ä¸»æœºçš„è§’åº¦æ¥çœ‹ï¼Œå®ƒçš„ cgroup è·¯å¾„æ˜¯ <code>/kubepods/burstable/&lt;POD_ID&gt;/&lt;DIND_CID&gt;</code>ã€‚</p>
<p>å½“ KinD åœ¨ DIND å®¹å™¨å†…çš„åµŒå¥—èŠ‚ç‚¹å®¹å™¨å†…å¯åŠ¨ kubelet çš„æ—¶å€™ï¼Œkubelet å°†åœ¨ <code>/kubepods/burstable/</code> ä¸‹ç›¸å¯¹äºåµŒå¥— KIND èŠ‚ç‚¹å®¹å™¨çš„æ ¹ cgroup ä¸ºå…¶ Pods æ¥æ“ä½œ cgroupã€‚ä»å®¿ä¸»æœºçš„è§’åº¦æ¥çœ‹ï¼Œcgroup è·¯å¾„å°±æ˜¯ <code>/kubepods/burstable/&lt;POD_ID&gt;/&lt;DIND_CID&gt;/docker/&lt;KIND_CID&gt;/kubepods/burstable/</code>ã€‚</p>
<p>è¿™äº›éƒ½æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯åœ¨åµŒå¥—çš„ KinD èŠ‚ç‚¹å®¹å™¨ä¸­ï¼Œæœ‰å¦ä¸€ä¸ª cgroup å­˜åœ¨äº <code>/kubepods/burstable/&lt;POD_ID&gt;/&lt;DIND_CID&gt;/docker/&lt;DIND_CID&gt;</code>ä¸‹é¢ï¼Œç›¸å¯¹äºåµŒå¥—çš„ KinD èŠ‚ç‚¹å®¹å™¨çš„æ ¹ cgroupï¼Œåœ¨ kubelet å¯åŠ¨ä¹‹å‰å°±å­˜åœ¨äº†ï¼Œè¿™æ˜¯ä¸Šé¢æˆ‘ä»¬è®¨è®ºè¿‡çš„ cgroups æŒ‚è½½é€ æˆçš„ï¼Œé€šè¿‡ KinD entrypoint è„šæœ¬è®¾ç½®ã€‚è€Œå¦‚æœä½ åœ¨ KinD èŠ‚ç‚¹å®¹å™¨é‡Œé¢åšä¸€ä¸ª <code>cat /kubepods/burstable/&lt;POD_ID&gt;/docker/&lt;DIND_CID&gt;/tasks</code>ï¼Œä½ ä¼šçœ‹åˆ° DinD å®¹å™¨çš„è¿›ç¨‹ã€‚</p>
<p>
  <img src="https://bxdc-static.oss-cn-beijing.aliyuncs.com/images/20200612111432.png" alt="k8s in k8s">

</p>
<p>è¿™å°±æ˜¯æœ€æ ¹æœ¬çš„åŸå› ï¼ŒKinD èŠ‚ç‚¹å®¹å™¨é‡Œé¢çš„ kubelet çœ‹åˆ°äº†è¿™ä¸ª cgroupï¼Œä»¥ä¸ºåº”è¯¥ç”±å®ƒæ¥ç®¡ç†ï¼Œä½†æ˜¯å´æ‰¾ä¸åˆ°å’Œè¿™ä¸ª cgroup ç›¸å…³è”çš„ Podï¼Œæ‰€ä»¥å°±ä¼šå°è¯•æ¥æ€æ­»å±äºè¿™ä¸ª cgroup çš„è¿›ç¨‹æ¥åˆ é™¤è¿™ä¸ª cgroupã€‚è¿™ä¸ªæ“ä½œçš„ç»“æœå°±æ˜¯éšæœºè¿›ç¨‹è¢«æ€æ­»ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•å¯ä»¥é€šè¿‡è®¾ç½® kubelet çš„<code>--cgroup-root</code> å‚æ•°ï¼Œé€šè¿‡è¯¥æ ‡å¿—æ¥æŒ‡ç¤º KinD èŠ‚ç‚¹å®¹å™¨å†…çš„ kubelet ä¸ºå…¶ Pods ä½¿ç”¨ä¸é€šçš„ cgroup æ ¹è·¯å¾„ï¼ˆæ¯”å¦‚ /kubeletï¼‰ã€‚è¿™æ ·å°±å¯ä»¥åœ¨ Kubernetes é›†ç¾¤ä¸­æ¥å¯åŠ¨ KinD é›†ç¾¤äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„ YAML èµ„æºæ¸…å•æ–‡ä»¶æ¥ä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#ff79c6">apiVersion</span>: v1
<span style="color:#ff79c6">kind</span>: Pod
<span style="color:#ff79c6">metadata</span>:
  <span style="color:#ff79c6">name</span>: kind-cluster
<span style="color:#ff79c6">spec</span>:
  <span style="color:#ff79c6">containers</span>:
  - <span style="color:#ff79c6">image</span>: jieyu/kind-cluster-buster:v0.1.0
    <span style="color:#ff79c6">name</span>: kind-cluster
    <span style="color:#ff79c6">stdin</span>: <span style="color:#ff79c6">true</span>
    <span style="color:#ff79c6">tty</span>: <span style="color:#ff79c6">true</span>
    <span style="color:#ff79c6">args</span>:
    - /bin/bash
    <span style="color:#ff79c6">env</span>:
    - <span style="color:#ff79c6">name</span>: API_SERVER_ADDRESS
      <span style="color:#ff79c6">valueFrom</span>:
        <span style="color:#ff79c6">fieldRef</span>:
          <span style="color:#ff79c6">fieldPath</span>: status.podIP
    <span style="color:#ff79c6">volumeMounts</span>:
    - <span style="color:#ff79c6">mountPath</span>: /var/lib/docker
      <span style="color:#ff79c6">name</span>: varlibdocker
    - <span style="color:#ff79c6">mountPath</span>: /lib/modules
      <span style="color:#ff79c6">name</span>: libmodules
      <span style="color:#ff79c6">readOnly</span>: <span style="color:#ff79c6">true</span>
    <span style="color:#ff79c6">securityContext</span>:
      <span style="color:#ff79c6">privileged</span>: <span style="color:#ff79c6">true</span>
    <span style="color:#ff79c6">ports</span>:
    - <span style="color:#ff79c6">containerPort</span>: <span style="color:#bd93f9">30001</span>
      <span style="color:#ff79c6">name</span>: api-server-port
      <span style="color:#ff79c6">protocol</span>: TCP
    <span style="color:#ff79c6">readinessProbe</span>:
      <span style="color:#ff79c6">failureThreshold</span>: <span style="color:#bd93f9">15</span>
      <span style="color:#ff79c6">httpGet</span>:
        <span style="color:#ff79c6">path</span>: /healthz
        <span style="color:#ff79c6">port</span>: api-server-port
        <span style="color:#ff79c6">scheme</span>: HTTPS
      <span style="color:#ff79c6">initialDelaySeconds</span>: <span style="color:#bd93f9">120</span>
      <span style="color:#ff79c6">periodSeconds</span>: <span style="color:#bd93f9">20</span>
      <span style="color:#ff79c6">successThreshold</span>: <span style="color:#bd93f9">1</span>
      <span style="color:#ff79c6">timeoutSeconds</span>: <span style="color:#bd93f9">1</span>
  <span style="color:#ff79c6">volumes</span>:
  - <span style="color:#ff79c6">name</span>: varlibdocker
    <span style="color:#ff79c6">emptyDir</span>: {}
  - <span style="color:#ff79c6">name</span>: libmodules
    <span style="color:#ff79c6">hostPath</span>:
      <span style="color:#ff79c6">path</span>: /lib/modules
</code></pre></div><p>ä½¿ç”¨ä¸Šé¢çš„èµ„æºæ¸…å•æ–‡ä»¶åˆ›å»ºå®Œæˆåï¼Œç¨ç­‰ä¸€ä¼šå„¿æˆ‘ä»¬å°±å¯ä»¥è¿›å…¥ Pod ä¸­æ¥éªŒè¯ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl <span style="color:#8be9fd;font-style:italic">exec</span> -ti kind-cluster /bin/bash
root@kind-cluster:/# kubectl get nodes
NAME                 STATUS   ROLES    AGE   VERSION                                                                                                                   
kind-control-plane   Ready    master   72s   v1.17.0
</code></pre></div><p>åŒæ ·ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ Docker CLI æ¥è¿›è¡Œæµ‹è¯•ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ docker run -ti --rm --privileged jieyu/kind-cluster-buster:v0.1.0 /bin/bash
Waiting <span style="color:#ff79c6">for</span> dockerd...
Setting up KIND cluster
Creating cluster <span style="color:#f1fa8c">&#34;kind&#34;</span> ...
 âœ“ Ensuring node image <span style="color:#ff79c6">(</span>jieyu/kind-node:v1.17.0<span style="color:#ff79c6">)</span> ğŸ–¼ 
 âœ“ Preparing nodes ğŸ“¦  
 âœ“ Writing configuration ğŸ“œ 
 âœ“ Starting control-plane ğŸ•¹ï¸ 
 âœ“ Installing CNI ğŸ”Œ 
 âœ“ Installing StorageClass ğŸ’¾ 
 âœ“ Waiting â‰¤ 15m0s <span style="color:#ff79c6">for</span> control-plane <span style="color:#ff79c6">=</span> Ready â³ 
 â€¢ Ready after 31s ğŸ’š
Set kubectl context to <span style="color:#f1fa8c">&#34;kind-kind&#34;</span>
You can now use your cluster with:
kubectl cluster-info --context kind-kind
Have a nice day! ğŸ‘‹
root@d95fa1302557:/# kubectl get nodes
NAME                 STATUS   ROLES    AGE   VERSION
kind-control-plane   Ready    master   71s   v1.17.0
root@d95fa1302557:/#
</code></pre></div><blockquote>
<p>ä¸Šé¢é•œåƒå¯¹åº”çš„ Dockerfile å’Œå¯åŠ¨è„šæœ¬åœ°å€ï¼š<a href="https://github.com/jieyu/docker-images/tree/master/kind-cluster">https://github.com/jieyu/docker-images/tree/master/kind-cluster</a></p>
</blockquote>
<p>ä¸‹å›¾æ˜¯æˆ‘åœ¨ KinD æ­å»ºçš„ Kubernetes é›†ç¾¤ä¸­ï¼Œåˆ›å»ºçš„ä¸€ä¸ª Podï¼Œç„¶ååœ¨ Pod ä¸­åˆ›å»ºçš„ä¸€ä¸ªç‹¬ç«‹çš„ Kubernetes é›†ç¾¤æœ€ç»ˆæ•ˆæœï¼š</p>
<p>
  <img src="https://bxdc-static.oss-cn-beijing.aliyuncs.com/images/20200612115324.png" alt="k8s in k8s">

</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>åœ¨å®ç°ä¸Šé¢åŠŸèƒ½çš„æ—¶å€™ï¼Œè¿‡ç¨‹ä¸­è¿˜æ˜¯é‡åˆ°äº†ä¸å°‘çš„éšœç¢ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†éƒ½æ˜¯å› ä¸º Docker å®¹å™¨æ²¡æœ‰æä¾›å’Œå®¿ä¸»æœºå®Œå…¨éš”ç¦»çš„åŠŸèƒ½é€ æˆçš„ï¼ŒæŸäº›å†…æ ¸èµ„æºæ¯”å¦‚ cgroups æ˜¯åœ¨å†…æ ¸ä¸­å…±äº«çš„ï¼Œå¦‚æœå¾ˆå¤šå®¹å™¨åŒæ—¶æ“ä½œå®ƒä»¬ï¼Œä¹Ÿå¯èƒ½ä¼šé€ æˆæ½œåœ¨çš„å†²çªã€‚ä½†æ˜¯ä¸€æ—¦è§£å†³äº†è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬å°±å¯ä»¥éå¸¸æ–¹ä¾¿çš„åœ¨ Kubernetes é›†ç¾¤ Pod ä¸­è½»æ¾åœ°è¿è¡Œä¸€ä¸ªç‹¬ç«‹çš„ Kubernetes é›†ç¾¤äº†ï¼Œè¿™åº”è¯¥ç®—çœŸæ­£çš„ Kubernetes IN Kubernetes äº†å§~</p>
<blockquote>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://d2iq.com/blog/running-kind-inside-a-kubernetes-cluster-for-continuous-integration?utm_sq=gf2bqwb34d">https://d2iq.com/blog/running-kind-inside-a-kubernetes-cluster-for-continuous-integration</a></p>
</blockquote>
<!-- raw HTML omitted -->

                
                
<div class="entry-shang text-center">
    
	    <p> ã€Œå¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰ç”¨,è¯·éšæ„æ‰“èµã€</p>
	
	<button class="zs show-zs btn btn-bred">èµèµæ”¯æŒ</button>
</div>
<div class="zs-modal-bg"></div>
<div class="zs-modal-box">
	<div class="zs-modal-head">
		<button type="button" class="close">Ã—</button>
		<span class="author"><a href="https://qnxr.xyz"><img src="/img/favicon.png" />é’å¹´å¤æ—¥IT</a></span>
        
	        <p class="tip"><i></i><span>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰ç”¨,è¯·éšæ„æ‰“èµ</span></p>
		
 
	</div>
	<div class="zs-modal-body">
		<div class="zs-modal-btns">
			<button class="btn btn-blink" data-num="2">2å…ƒ</button>
			<button class="btn btn-blink" data-num="5">5å…ƒ</button>
			<button class="btn btn-blink" data-num="10">10å…ƒ</button>
			<button class="btn btn-blink" data-num="50">50å…ƒ</button>
			<button class="btn btn-blink" data-num="100">100å…ƒ</button>
			<button class="btn btn-blink" data-num="1">ä»»æ„é‡‘é¢</button>
		</div>
		<div class="zs-modal-pay">
			<button class="btn btn-bred" id="pay-text">2å…ƒ</button>
			<p>ä½¿ç”¨<span id="pay-type">å¾®ä¿¡</span>æ‰«æäºŒç»´ç å®Œæˆæ”¯ä»˜</p>
			<img src="/img/reward/wechat-2.png"  id="pay-image"/>
		</div>
	</div>
	<div class="zs-modal-footer">
		<label><input type="radio" name="zs-type" value="wechat" class="zs-type" checked="checked"><span ><span class="zs-wechat"><img src="/img/reward/wechat-btn.png"/></span></label>
		<label><input type="radio" name="zs-type" value="alipay" class="zs-type" class="zs-alipay"><img src="/img/reward/alipay-btn.png"/></span></label>
	</div>
</div>
<script type="text/javascript" src="/js/reward.js"></script>

                

                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/post/deploy-k8s-on-win-use-wsl2/" data-toggle="tooltip" data-placement="top" title="åœ¨ Windows ä¸‹ä½¿ç”¨ WSL2 æ­å»º Kubernetes é›†ç¾¤">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/post/status-in-pv-pvc/" data-toggle="tooltip" data-placement="top" title="Kubernetes ä¸­ PV å’Œ PVC çš„çŠ¶æ€å˜åŒ–">Next
                            Post &rarr;</a>
                    </li>
                    
                </ul>

                
<div id="disqus-comment"></div>



            </div>
            
            <div class="
                col-lg-11 col-lg-offset-1
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">æ ‡ç­¾</a></h5>
                    <div class="tags">
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/affinity" title="affinity">
                            affinity
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/alertmanager" title="alertmanager">
                            alertmanager
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/argo" title="argo">
                            argo
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/cd" title="cd">
                            cd
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/ci" title="ci">
                            ci
                        </a>
                        
                        
                        
                        <a href="/tags/ci/cd" title="ci/cd">
                            ci/cd
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/configmap" title="configmap">
                            configmap
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/coredns" title="coredns">
                            coredns
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/dashboard" title="dashboard">
                            dashboard
                        </a>
                        
                        
                        
                        <a href="/tags/deployment" title="deployment">
                            deployment
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/devops" title="devops">
                            devops
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/django" title="django">
                            django
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/docker" title="docker">
                            docker
                        </a>
                        
                        
                        
                        <a href="/tags/dockerfile" title="dockerfile">
                            dockerfile
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/drone" title="drone">
                            drone
                        </a>
                        
                        
                        
                        <a href="/tags/efk" title="efk">
                            efk
                        </a>
                        
                        
                        
                        <a href="/tags/elastic" title="elastic">
                            elastic
                        </a>
                        
                        
                        
                        <a href="/tags/elasticsearch" title="elasticsearch">
                            elasticsearch
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/envoy" title="envoy">
                            envoy
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/flask" title="flask">
                            flask
                        </a>
                        
                        
                        
                        <a href="/tags/fluentd" title="fluentd">
                            fluentd
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/github" title="github">
                            github
                        </a>
                        
                        
                        
                        <a href="/tags/gitlab" title="gitlab">
                            gitlab
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/gitops" title="gitops">
                            gitops
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/goland" title="goland">
                            goland
                        </a>
                        
                        
                        
                        <a href="/tags/golang" title="golang">
                            golang
                        </a>
                        
                        
                        
                        <a href="/tags/grafana" title="grafana">
                            grafana
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/haproxy" title="haproxy">
                            haproxy
                        </a>
                        
                        
                        
                        <a href="/tags/harbor" title="harbor">
                            harbor
                        </a>
                        
                        
                        
                        <a href="/tags/helm" title="helm">
                            helm
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/https" title="https">
                            https
                        </a>
                        
                        
                        
                        <a href="/tags/hugo" title="hugo">
                            hugo
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/ingress" title="ingress">
                            ingress
                        </a>
                        
                        
                        
                        <a href="/tags/ingress-nginx" title="ingress-nginx">
                            ingress-nginx
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/iptables" title="iptables">
                            iptables
                        </a>
                        
                        
                        
                        <a href="/tags/ipvs" title="ipvs">
                            ipvs
                        </a>
                        
                        
                        
                        <a href="/tags/istio" title="istio">
                            istio
                        </a>
                        
                        
                        
                        <a href="/tags/java" title="java">
                            java
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/jenkins" title="jenkins">
                            jenkins
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/k8s" title="k8s">
                            k8s
                        </a>
                        
                        
                        
                        <a href="/tags/k8s%E6%8A%80%E6%9C%AF%E5%9C%88" title="k8sæŠ€æœ¯åœˆ">
                            k8sæŠ€æœ¯åœˆ
                        </a>
                        
                        
                        
                        <a href="/tags/kafka" title="kafka">
                            kafka
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/kibana" title="kibana">
                            kibana
                        </a>
                        
                        
                        
                        <a href="/tags/kind" title="kind">
                            kind
                        </a>
                        
                        
                        
                        <a href="/tags/kong" title="kong">
                            kong
                        </a>
                        
                        
                        
                        <a href="/tags/kubeadm" title="kubeadm">
                            kubeadm
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/kubelet" title="kubelet">
                            kubelet
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/kubernetes" title="kubernetes">
                            kubernetes
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/kustomize" title="kustomize">
                            kustomize
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/loki" title="loki">
                            loki
                        </a>
                        
                        
                        
                        <a href="/tags/mac" title="mac">
                            mac
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/microservice" title="microservice">
                            microservice
                        </a>
                        
                        
                        
                        <a href="/tags/monitor" title="monitor">
                            monitor
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/netfilter" title="netfilter">
                            netfilter
                        </a>
                        
                        
                        
                        <a href="/tags/nfs" title="nfs">
                            nfs
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/nginx" title="nginx">
                            nginx
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/operator" title="operator">
                            operator
                        </a>
                        
                        
                        
                        <a href="/tags/ops" title="ops">
                            ops
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/pipeline" title="pipeline">
                            pipeline
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/pod" title="pod">
                            pod
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/prometheus" title="prometheus">
                            prometheus
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/pv" title="pv">
                            pv
                        </a>
                        
                        
                        
                        <a href="/tags/pvc" title="pvc">
                            pvc
                        </a>
                        
                        
                        
                        <a href="/tags/pycharm" title="pycharm">
                            pycharm
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/python" title="python">
                            python
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/rbac" title="rbac">
                            rbac
                        </a>
                        
                        
                        
                        <a href="/tags/react" title="react">
                            react
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/scheduler" title="scheduler">
                            scheduler
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/security" title="security">
                            security
                        </a>
                        
                        
                        
                        <a href="/tags/service" title="service">
                            service
                        </a>
                        
                        
                        
                        <a href="/tags/service-api" title="service-api">
                            service-api
                        </a>
                        
                        
                        
                        <a href="/tags/service-mesh" title="service-mesh">
                            service-mesh
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/slave" title="slave">
                            slave
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/storageclass" title="storageclass">
                            storageclass
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/tcpdump" title="tcpdump">
                            tcpdump
                        </a>
                        
                        
                        
                        <a href="/tags/tdd" title="tdd">
                            tdd
                        </a>
                        
                        
                        
                        <a href="/tags/tekton" title="tekton">
                            tekton
                        </a>
                        
                        
                        
                        <a href="/tags/tips" title="tips">
                            tips
                        </a>
                        
                        
                        
                        <a href="/tags/traefik" title="traefik">
                            traefik
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/vault" title="vault">
                            vault
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/vscode" title="vscode">
                            vscode
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/webpack" title="webpack">
                            webpack
                        </a>
                        
                        
                        
                        <a href="/tags/websocket" title="websocket">
                            websocket
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/wsl" title="wsl">
                            wsl
                        </a>
                        
                        
                        
                        <a href="/tags/yaml" title="yaml">
                            yaml
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1" title="å¾®æœåŠ¡">
                            å¾®æœåŠ¡
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E7%9F%A5%E8%AF%86%E6%98%9F%E7%90%83" title="çŸ¥è¯†æ˜Ÿçƒ">
                            çŸ¥è¯†æ˜Ÿçƒ
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E8%AF%BE%E7%A8%8B" title="è¯¾ç¨‹">
                            è¯¾ç¨‹
                        </a>
                        
                        
                        
                        <a href="/tags/%E8%B0%83%E5%BA%A6" title="è°ƒåº¦">
                            è°ƒåº¦
                        </a>
                        
                        
                        
                        <a href="/tags/%E9%98%BF%E9%87%8C%E4%BA%91" title="é˜¿é‡Œäº‘">
                            é˜¿é‡Œäº‘
                        </a>
                        
                        
                        
                        
                        
                        
                    </div>
                </section>
                

                
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                    
                    <li>
                        <a href="mailto:1290851757@qq.com">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    

                    
                    <li>
                        <a href="img/wechat_qrcode.jpg">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    

                    
                    <li>
                        <a target="_blank" href="img/wechat_qrcode.jpg">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    

		    
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/xiaobingchan">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    <li>
                        <a target="_blank" href="img/alipay.jpg">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    
                    
            
            
            
                </ul>
		<p class="copyright text-muted">
                    Copyright &copy; é’å¹´å¤æ—¥IT 2021
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite"></a><a href="http://qnxr.xyz">é’å¹´å¤æ—¥ITç‰ˆæƒæ‰€æœ‰</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=xiaobingchan&repo=xiaobingchan.github.io&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-150373352-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</body>
</html>
